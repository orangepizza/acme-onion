<?xml version="1.0" encoding="us-ascii"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc version 1.6.8 (Ruby 3.0.2) -->


<!DOCTYPE rfc  [
  <!ENTITY nbsp    "&#160;">
  <!ENTITY zwsp   "&#8203;">
  <!ENTITY nbhy   "&#8209;">
  <!ENTITY wj     "&#8288;">

]>


<rfc ipr="trust200902" docName="draft-suchan-acme-onionv3-00" category="std" consensus="true" submissionType="IETF" tocInclude="true" sortRefs="true" symRefs="true">
  <front>
    <title abbrev="ACME-ONION">Automated Certificate Management Environment (ACME) Onion Identifier Validation Extension</title>

    <author initials="" surname="Seo Suchan" fullname="Seo Suchan">
      <organization></organization>
      <address>
        <email>tjtncks@gmail.com</email>
      </address>
    </author>

    <date year="2022" month="May" day="02"/>

    <area>General</area>
    <workgroup>ACME Working Group</workgroup>
    

    <abstract>


<t>This document specifies identifiers and challenges required to enable the Automated Certificate Management Environment (ACME) to issue certificates for Tor Project&#39;s onion V3 addresses.</t>



    </abstract>



  </front>

  <middle>


<section anchor="introduction"><name>Introduction</name>

<t>While onion addresses are in form of DNS address, they aren&#39;t in part of ICANN hierarchy, and onion name&#39;s self-verifying construction warrents different verification, duce different identfier type for them is worth consider.</t>

</section>
<section anchor="terminology"><name>Terminology</name>

<t>In this document, the key words &quot;MUST&quot;, &quot;MUST NOT&quot;, &quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;, &quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;, &quot;MAY&quot;, and &quot;OPTIONAL&quot; are to be interpreted as described in BCP 14, <xref target="RFC2119"/>.</t>

</section>
<section anchor="onion-identifier"><name>Onion Identifier</name>

<t><xref target="RFC8555"/> only defines the identifier type &quot;dns&quot;, but it assumes it&#39;s on public CA/B hirearuchy</t>

<t>An identifier for the onion address acmeulkebl5k66q4sgcgzpe3tddrffnpn5gpnkpamz4zcuv5hk7fqwad.onion would be formatted like:</t>

<figure><artwork><![CDATA[
{"type": "onion-v3", "value": "acmeulkebl5k66q4sgcgzpe3tddrffnpn5gpnkpamz4zcuv5hk7fqwad.onion"}
]]></artwork></figure>

</section>
<section anchor="validation-challenges-for-onion-address"><name>Validation Challenges for onion address</name>

<t>Onion-v3 identifiers MAY be used with the existing &quot;http-01&quot; and &quot;tls-alpn-01&quot; challenges from <xref target="RFC8555"/> Section 8.3 and <xref target="RFC8737"/> Section 3 respectively. To use Onion identifiers with these challenges their initial DNS resolution step MUST be skipped and the approperate Tor daemon that in control of CA MUST used to proxy such request.</t>

<t>The exsisting &quot;dns-01&quot; challange MUST NOT be used to validate onion addresses.</t>

<t>In addition to challanges earlier RFC defined, there</t>

<section anchor="csr-signed-with-onion-public-key-challagne"><name>CSR signed with Onion public key challagne</name>

<t>With Onion-csr validation, the client in an ACME transaction proves its control of oninon address by proving the possesion of onion hidden service identity key. The ACME server challenges the client to sign CSR that includes the nonce it gave with.</t>

<t>The Onion-csr ACME challenge object has the following format:</t>

<dl>
  <dt>type (required, string):</dt>
  <dd>
    <t>The string &quot;onion-v3-csr</t>
  </dd>
  <dt>token (required, string):</dt>
  <dd>
    <t>A random value that uniquely identifies the challenge. This value MUST have at least 128 bits of entropy. It MUST NOT contain any characters outside the base64url alphabet as described in <xref target="RFC4648"/> Section 5. Trailing &#39;=&#39; padding characters MUST be stripped. See <xref target="RFC4086"/> for additional information on randomness requirements.</t>
  </dd>
</dl>

<t>The client prepares for validation by constructing a self-signed CSR that MUST contain an cabf caSigningNonce Attribute and a subjectAlternativeName extension <xref target="RFC5280"/>. The subjectAlternativeName extension MUST contain a single dNSName entry where the value is the domain name being validated. The cabf caSigningNonce Attribute MUST contain the token string as ascii encoded for the challenge.</t>

<t>The cabf caSigningNonce Attribute is identified by the cabf-caSigningNonce object identifier (OID) in the cabf arc <xref target="RFC5280"/>. conseurt <xref target="cabr"/> appendex B for how to construct CSR itself in detail.</t>

<t>A client fulfills this challenge by construct the challange CSR from the &quot;token&quot; value provided in the challange, then POST on challange URL with crafted CSR as payload to request validated by the server.</t>

<figure><artwork><![CDATA[
POST /acme/authz/1234/1
Host: example.com
Content-Type: application/jose+json

{
  "protected": base64url({
    "alg": "ES256",
    "kid": "https://example.com/acme/acct/1",
    "nonce": "XaYcb5XoTUgRWbTWw_NwkcP",
    "url": "https://example.com/acme/authz/1234/1"
  }),
  "payload": base64url({
       "csr": "MIIBBzCBugIBADAAMCo...gRYTMAhRP8nIH",
     }),
  "signature": "0wSzBJBgNVHREEQ...gYJKoZIhvcNAQkOM"
}
]]></artwork></figure>

<t>On receiving this request from client, the server verifies client&#39;s control over the onion address by verifiy that CSR is crafted with expected properties:</t>

<t><list style="numbers">
  <t>CSR is signed with private part of identity key the requested onion address made from.</t>
  <t>A caSigningNonce attribute that contains token Value that challenge object provided.</t>
</list></t>

</section>
</section>
<section anchor="iana-considerations"><name>IANA Considerations</name>

<section anchor="identifier-types"><name>Identifier Types</name>

<t>Adds a new type to the Identifier list defined in Section 9.7.7 of <xref target="RFC8555"/> with the label &quot;onion-v3&quot; and reference I-D.ietf-acme-onion.</t>

</section>
<section anchor="challenge-types"><name>Challenge Types</name>

<t>in the Validation Methods list defined in Section 9.7.8 of <xref target="RFC8555"/>:</t>

<t>Adds the raw &quot;onin-challange-csr&quot; to the Validation Methods.</t>

<t>Adds the value &quot;onion-v3-csr&quot; to the Identifier Type column  for the &quot;http-01&quot;, &quot;onion-challange-csr&quot;, and &quot;tls-alpn-01&quot; challenges.</t>

</section>
</section>
<section anchor="security-considerations"><name>Security Considerations</name>

<t>As onion addresses are able to generated in massive quantity without financial cost, it bypasses the normal ratelimit CAs imposess. CAs SHOULD adapt some mesure to prevent DoSing the CA by create hugh amount of request for onion address. For exemple, imposing limit per ACME account or require order to have at least one non-onion domain.</t>

</section>
<section anchor="note"><name>note</name>
<t>this doc is made as documentation of my pebble tree does: process may change in track</t>

</section>


  </middle>

  <back>


    <references title='Normative References'>





<reference anchor='RFC2119' target='https://www.rfc-editor.org/info/rfc2119'>
<front>
<title>Key words for use in RFCs to Indicate Requirement Levels</title>
<author fullname='S. Bradner' initials='S.' surname='Bradner'><organization/></author>
<date month='March' year='1997'/>
<abstract><t>In many standards track documents several words are used to signify the requirements in the specification.  These words are often capitalized. This document defines these words as they should be interpreted in IETF documents.  This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t></abstract>
</front>
<seriesInfo name='BCP' value='14'/>
<seriesInfo name='RFC' value='2119'/>
<seriesInfo name='DOI' value='10.17487/RFC2119'/>
</reference>



<reference anchor='RFC4086' target='https://www.rfc-editor.org/info/rfc4086'>
<front>
<title>Randomness Requirements for Security</title>
<author fullname='D. Eastlake 3rd' initials='D.' surname='Eastlake 3rd'><organization/></author>
<author fullname='J. Schiller' initials='J.' surname='Schiller'><organization/></author>
<author fullname='S. Crocker' initials='S.' surname='Crocker'><organization/></author>
<date month='June' year='2005'/>
<abstract><t>Security systems are built on strong cryptographic algorithms that foil pattern analysis attempts.  However, the security of these systems is dependent on generating secret quantities for passwords, cryptographic keys, and similar quantities.  The use of pseudo-random processes to generate secret quantities can result in pseudo-security. A sophisticated attacker may find it easier to reproduce the environment that produced the secret quantities and to search the resulting small set of possibilities than to locate the quantities in the whole of the potential number space.</t><t>Choosing random quantities to foil a resourceful and motivated adversary is surprisingly difficult.  This document points out many pitfalls in using poor entropy sources or traditional pseudo-random number generation techniques for generating such quantities.  It recommends the use of truly random hardware techniques and shows that the existing hardware on many systems can be used for this purpose. It provides suggestions to ameliorate the problem when a hardware solution is not available, and it gives examples of how large such quantities need to be for some applications.  This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t></abstract>
</front>
<seriesInfo name='BCP' value='106'/>
<seriesInfo name='RFC' value='4086'/>
<seriesInfo name='DOI' value='10.17487/RFC4086'/>
</reference>



<reference anchor='RFC4648' target='https://www.rfc-editor.org/info/rfc4648'>
<front>
<title>The Base16, Base32, and Base64 Data Encodings</title>
<author fullname='S. Josefsson' initials='S.' surname='Josefsson'><organization/></author>
<date month='October' year='2006'/>
<abstract><t>This document describes the commonly used base 64, base 32, and base 16 encoding schemes.  It also discusses the use of line-feeds in encoded data, use of padding in encoded data, use of non-alphabet characters in encoded data, use of different encoding alphabets, and canonical encodings.  [STANDARDS-TRACK]</t></abstract>
</front>
<seriesInfo name='RFC' value='4648'/>
<seriesInfo name='DOI' value='10.17487/RFC4648'/>
</reference>



<reference anchor='RFC5280' target='https://www.rfc-editor.org/info/rfc5280'>
<front>
<title>Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</title>
<author fullname='D. Cooper' initials='D.' surname='Cooper'><organization/></author>
<author fullname='S. Santesson' initials='S.' surname='Santesson'><organization/></author>
<author fullname='S. Farrell' initials='S.' surname='Farrell'><organization/></author>
<author fullname='S. Boeyen' initials='S.' surname='Boeyen'><organization/></author>
<author fullname='R. Housley' initials='R.' surname='Housley'><organization/></author>
<author fullname='W. Polk' initials='W.' surname='Polk'><organization/></author>
<date month='May' year='2008'/>
<abstract><t>This memo profiles the X.509 v3 certificate and X.509 v2 certificate revocation list (CRL) for use in the Internet.  An overview of this approach and model is provided as an introduction.  The X.509 v3 certificate format is described in detail, with additional information regarding the format and semantics of Internet name forms.  Standard certificate extensions are described and two Internet-specific extensions are defined.  A set of required certificate extensions is specified.  The X.509 v2 CRL format is described in detail along with standard and Internet-specific extensions.  An algorithm for X.509 certification path validation is described.  An ASN.1 module and examples are provided in the appendices.  [STANDARDS-TRACK]</t></abstract>
</front>
<seriesInfo name='RFC' value='5280'/>
<seriesInfo name='DOI' value='10.17487/RFC5280'/>
</reference>



<reference anchor='RFC8555' target='https://www.rfc-editor.org/info/rfc8555'>
<front>
<title>Automatic Certificate Management Environment (ACME)</title>
<author fullname='R. Barnes' initials='R.' surname='Barnes'><organization/></author>
<author fullname='J. Hoffman-Andrews' initials='J.' surname='Hoffman-Andrews'><organization/></author>
<author fullname='D. McCarney' initials='D.' surname='McCarney'><organization/></author>
<author fullname='J. Kasten' initials='J.' surname='Kasten'><organization/></author>
<date month='March' year='2019'/>
<abstract><t>Public Key Infrastructure using X.509 (PKIX) certificates are used for a number of purposes, the most significant of which is the authentication of domain names.  Thus, certification authorities (CAs) in the Web PKI are trusted to verify that an applicant for a certificate legitimately represents the domain name(s) in the certificate.  As of this writing, this verification is done through a collection of ad hoc mechanisms.  This document describes a protocol that a CA and an applicant can use to automate the process of verification and certificate issuance.  The protocol also provides facilities for other certificate management functions, such as certificate revocation.</t></abstract>
</front>
<seriesInfo name='RFC' value='8555'/>
<seriesInfo name='DOI' value='10.17487/RFC8555'/>
</reference>



<reference anchor='RFC8737' target='https://www.rfc-editor.org/info/rfc8737'>
<front>
<title>Automated Certificate Management Environment (ACME) TLS Application-Layer Protocol Negotiation (ALPN) Challenge Extension</title>
<author fullname='R.B. Shoemaker' initials='R.B.' surname='Shoemaker'><organization/></author>
<date month='February' year='2020'/>
<abstract><t>This document specifies a new challenge for the Automated Certificate Management Environment (ACME) protocol that allows for domain control validation using TLS.</t></abstract>
</front>
<seriesInfo name='RFC' value='8737'/>
<seriesInfo name='DOI' value='10.17487/RFC8737'/>
</reference>


<reference anchor="cabr" target="https://cabforum.org/wp-content/uploads/CA-Browser-Forum-BR-1.8.4.pdf">
  <front>
    <title>CA/B forum baseline requirement</title>
    <author initials="C." surname="Forum" fullname="CA/Browser Forum">
      <organization></organization>
    </author>
    <date year="2022"/>
  </front>
</reference>


    </references>




  </back>

<!-- ##markdown-source:
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
5gASJDpTniYRNBcNrKZVMc2LwoWWbUcdbVjt/MAVgERyjaTPHfZip44UU2QW
sunRIeZhLT5cIQZAwU7Yp+v3gd5TGldrxCIYpdzQDEHG1MVpF+3Gr4FLk0fd
Ct+wR03JHo05d3sHh0fHewfRO+MwuKhbuSwLxaPYIAwrcZhI4cei7oX3vhmn
/v7NUfd+j7mnA6s8gqUy9DtbGnlxzyNRRxYzaoMuxocnrzrd8G2R09ZOMya1
bq01S1O/d9DsZl6n/X/Kr+nk5E9z82l2/WVy82X912i9SD80+3Dpr6W27O3g
yMPLLmsfPPkT3UkoCJ2EXg6HZ2d3g7NqNjzrn/f7lwOTJMns+uvNZX9+/eFU
D9/VajRiiWCkryxrvr8e3539fjYbfX53fXHxkY5+/f0P86/hfJWO+h8XV5ed
6HGndwXaU6nK64qau22YGVoBnd1WmOtxBQQY1p63qjUt/9gcAyXhzCZQIKeC
2wKNUaduS46sCE2Uh3xUxYOk2dxuQEqbr6jJaQaydoXn62sLVPZEkaVEDSKz
kugwQYV8QgVyyx6sZk1Rruanz7s6+kNhb9INKRDx5Nkf9cWgHswYy45bqdbP
SIR2fOxnGMSk0GodZhSkGVnQ2ligBWz6MkrnpiC+SV4nr8n8doe87bULFNai
NSlwJbGKh0qYOozPk1z5aev3qCQ0e1vTagVrAmmNA5fKzw20/pVip08U69WW
cnTkmhVDp9SwD7Uzncb2H69KWqcDvz1qhDo/8RppjwgW1VKLbQnZzh3dRsBj
Dbq/nEd4BIWRlSWsPY1u3/30t4XwW4gRM/55zgdPLTF7oiKL75UMwKWwoUcS
8KXUKU0eKWiySz3mZFNKlhY6T3QrhSBBRb7E6gDX5ks0wbgx4bd6JpeZLL1w
BiUaQ24Vxm60LiuqNedm3PTPmEWowmDcBezn1Wwu5NJUmvNqSwRPh76EfplC
yirivW5QgAQGnZC+of8FuwZRtmmn8JgRRZgnfaXR3FUHINb9Bbtbg/Cj5kcM
4gFOYbn7TaPu3aZiiblATdjbVlGPAgKhvExD4nM7SrAmPKNhXET/AZJ/aJEY
FgAA

-->

</rfc>

